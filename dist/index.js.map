{"version":3,"file":"index.js","sources":["../src/utils/getBasicImageProps.js","../src/defaults.js","../src/utils/helpers.js","../src/utils/buildImageUrl.js","../src/getFixedGatsbyImage.js","../src/getFluidGatsbyImage.js"],"sourcesContent":["const validImageUrlPattern = /^(https?:)?\\/\\/a.storyblok.com\\/f\\/*[0-9]+\\/*[0-9]*x*[0-9]*\\/[A-Za-z0-9]+\\/[\\S]+\\.[a-zA-Z]+/\n\nfunction getBasicImageProps(image) {\n  let url = null\n  let lqip = null\n\n  if (typeof image === 'string') {\n    url = image\n  }\n\n  if (typeof image === 'object') {\n    url = image.image\n    lqip = image.base64 ? image.base64 : null\n  }\n\n  url = validImageUrlPattern.test(url) ? url : null\n\n  if (!url) {\n    return false\n  }\n\n  const storyblokRegex = /^(https?:)?\\/\\/a.storyblok.com\\//\n  let originalPath = url.replace(storyblokRegex, '')\n\n  let [, , dimensions, , filename] = originalPath.split('/')\n  let [width, height] = dimensions.split('x').map((num) => parseInt(num, 10))\n  let [, extension] = filename.split('.')\n\n  let aspectRatio = width / height\n  let metadata = { dimensions: { width, height, aspectRatio }, lqip }\n\n  return {\n    originalPath,\n    extension,\n    metadata\n  }\n}\n\nexport default getBasicImageProps","export const DEFAULT_FIXED_WIDTH = 400\nexport const DEFAULT_FLUID_MAX_WIDTH = 800\nexport const STORYBLOK_BASE_URL = 'https://img2.storyblok.com'\n\nexport const sizeMultipliersFixed = [1, 1.5, 2, 3]\nexport const sizeMultipliersFluid = [0.25, 0.5, 1, 1.5, 2, 3]\n\nexport const defaultOptions = {\n  quality: 100,\n  smartCrop: true,\n  format: null,\n  fill: null,\n  toFormat: null,\n  base64: null,\n  useBase64: true\n}\n\nexport const defaultFluidOptions = {\n  ...defaultOptions,\n  maxWidth: DEFAULT_FLUID_MAX_WIDTH,\n  maxHeight: null\n}\n\nexport const defaultFixedOptions = {\n  ...defaultOptions,\n  width: DEFAULT_FIXED_WIDTH,\n  height: null\n}\n","export function applyFilters(filters) {\n  return filters.reduce((acc, currentFilter, i) => {\n    return `${acc}:${currentFilter}`\n  }, '/filters')\n}\n\nexport function isWebP(url) {\n  const isConverted = url.includes('filters:format(webp)')\n  const isOriginal = /[a-f0-9]+-\\d+x\\d+\\.webp/.test(url)\n  return isConverted || isOriginal\n}\n","import { STORYBLOK_BASE_URL } from '../defaults'\nimport { applyFilters } from './helpers'\n\nfunction buildImageUrl(originalPath, image, rotation) {\n  let { width, height, smartCrop, quality, format, fill } = image\n\n  let [, extension] = originalPath.split('.')\n\n  let url = STORYBLOK_BASE_URL\n\n  if (width && height) {\n    url += `/${width}x${height}`\n  }\n\n  if (smartCrop) {\n    url += `/smart`\n  }\n\n  let filters = [\n    ...[quality && `quality(${quality})`],\n    ...[format && format !== extension && `format(${format})`],\n    ...[fill && `fill(${fill})`]\n  ]\n\n  // remove falsy elements\n  filters = filters.filter(element => Boolean(element) === true)\n\n  if (filters.length > 0) {\n    url += applyFilters(filters)\n  }\n\n  // add original path at the end\n  url += `/${originalPath}`\n  console.log(url);\n  url = url.replace('filters:quality(100)', `filters:quality(100):rotate(${rotation})`);\n  console.log(url);\n  return url\n}\n\nexport function buildLowFiUrl(originalPath, { width, height, aspectRatio }, rotation) {\n  return buildImageUrl(originalPath, {\n    width: (width / 3).toFixed(0),\n    height: (height / 3).toFixed(0),\n    quality: 10\n  }, rotation)\n}\n\nexport default buildImageUrl\n","import getBasicImageProps from './utils/getBasicImageProps'\nimport buildUrl, { buildLowFiUrl } from './utils/buildImageUrl'\nimport { isWebP } from './utils/helpers'\nimport { sizeMultipliersFixed, defaultFixedOptions } from './defaults'\n\nfunction getFixedGatsbyImage(image, args = {}) {\n  let imageProps = getBasicImageProps(image)\n\n  if (!imageProps) {\n    return null\n  }\n\n  let options = {\n    ...defaultFixedOptions,\n    ...args\n  }\n\n  let { width, height, base64, useBase64 } = options\n  let {\n    metadata: { dimensions, lqip },\n    originalPath\n  } = imageProps\n\n  let desiredAspectRatio = dimensions.aspectRatio\n\n  // If we're cropping, calculate the specified aspect ratio\n  if (options.height) {\n    desiredAspectRatio = width / options.height\n  }\n\n  let forceConvert = null\n  if (options.toFormat) {\n    forceConvert = options.toFormat\n  } else if (isWebP(originalPath)) {\n    forceConvert = 'jpg'\n  }\n\n  let widths = sizeMultipliersFixed.map(scale => Math.round(width * scale))\n  let initial = { webp: [], base: [] }\n\n  let srcSets = widths\n    .filter(currentWidth => currentWidth < dimensions.width)\n    .reduce((acc, currentWidth, i) => {\n      let resolution = `${sizeMultipliersFixed[i]}x`\n      let currentHeight = Math.round(currentWidth / desiredAspectRatio)\n\n      let size = {\n        ...options,\n        width: currentWidth,\n        height: currentHeight\n      }\n\n      let webpUrl = buildUrl(originalPath, {\n        ...size,\n        ...{ format: 'webp' }\n      })\n\n      let baseUrl = buildUrl(originalPath, {\n        ...size,\n        ...(forceConvert && { format: forceConvert })\n      })\n\n      acc.webp.push(`${webpUrl} ${resolution}`)\n      acc.base.push(`${baseUrl} ${resolution}`)\n\n      return acc\n    }, initial)\n\n  let outputHeight = Math.round(height ? height : width / desiredAspectRatio)\n\n  let imgSize = {\n    ...options,\n    width: width,\n    height: outputHeight\n  }\n\n  let src = buildUrl(originalPath, {\n    ...imgSize,\n    ...(forceConvert && { format: forceConvert })\n  })\n\n  let srcWebp = buildUrl(originalPath, {\n    ...imgSize,\n    ...{ format: 'webp' }\n  })\n\n  // base64String\n\n  return {\n    base64: buildLowFiUrl(originalPath, { width, height, aspectRatio: desiredAspectRatio }),\n    aspectRatio: desiredAspectRatio,\n    width: Math.round(width),\n    height: outputHeight,\n    src,\n    srcWebp,\n    srcSet: srcSets.base.join(',\\n') || null,\n    srcSetWebp: srcSets.webp.join(',\\n') || null\n  }\n}\n\nexport default getFixedGatsbyImage\n","import getBasicImageProps from './utils/getBasicImageProps'\nimport buildUrl, { buildLowFiUrl } from './utils/buildImageUrl'\nimport { isWebP } from './utils/helpers'\nimport { sizeMultipliersFluid, defaultFluidOptions } from './defaults'\n\nfunction getFluidGatsbyImage(image, args = {}, rotation = 0) {\n  let imageProps = getBasicImageProps(image)\n\n  if (!imageProps) {\n    return null\n  }\n\n  let options = {\n    ...defaultFluidOptions,\n    ...args\n  }\n\n  let { maxWidth, base64, useBase64 } = options\n\n  let {\n    metadata: { dimensions, lqip },\n    originalPath\n  } = imageProps\n\n  let desiredAspectRatio = dimensions.aspectRatio\n\n  // If we're cropping, calculate the specified aspect ratio\n  if (options.maxHeight) {\n    desiredAspectRatio = maxWidth / options.maxHeight\n  }\n\n  let maxHeight = options.maxHeight || Math.round(maxWidth / dimensions.aspectRatio)\n\n  let forceConvert = null\n  if (options.toFormat) {\n    forceConvert = options.toFormat\n  } else if (isWebP(originalPath)) {\n    forceConvert = 'jpg'\n  }\n\n  let sizes = options.sizes || `(max-width: ${maxWidth}px) 100vw, ${maxWidth}px`\n  let widths = sizeMultipliersFluid\n    .map((scale) => Math.round(maxWidth * scale))\n    .filter((width) => width < dimensions.width)\n    .concat(dimensions.width)\n\n  let initial = { webp: [], base: [] }\n  let srcSets = widths\n    .filter((currentWidth) => currentWidth < dimensions.width)\n    .reduce((acc, currentWidth) => {\n      let currentHeight = Math.round(currentWidth / desiredAspectRatio)\n\n      let size = {\n        width: currentWidth,\n        height: currentHeight\n      }\n\n      let webpUrl = buildUrl(originalPath, {\n        ...options,\n        ...size,\n        ...{ format: 'webp' }\n      }, rotation)\n\n      let baseUrl = buildUrl(originalPath, {\n        ...options,\n        ...size,\n        ...{ format: forceConvert }\n      }, rotation)\n\n      acc.webp.push(`${webpUrl} ${currentWidth}w`)\n      acc.base.push(`${baseUrl} ${currentWidth}w`)\n      return acc\n    }, initial)\n\n  let imgSize = { width: maxWidth, height: maxHeight }\n\n  let src = buildUrl(originalPath, {\n    ...options,\n    ...imgSize,\n    ...{ format: forceConvert }\n  }, rotation)\n\n  let srcWebp = buildUrl(originalPath, {\n    ...options,\n    ...imgSize,\n    ...{ format: 'webp' }\n  }, rotation)\n\n  return {\n    base64: buildLowFiUrl(originalPath, { width: maxWidth, height: maxHeight, aspectRatio: desiredAspectRatio }, rotation),\n    aspectRatio: desiredAspectRatio,\n    src,\n    srcWebp,\n    srcSet: srcSets.base.join(',\\n') || null,\n    srcSetWebp: srcSets.webp.join(',\\n') || null,\n    sizes\n  }\n}\n\nexport default getFluidGatsbyImage\n"],"names":["validImageUrlPattern","getBasicImageProps","image","url","lqip","base64","test","replace","_originalPath$split","originalPath","split","filename","_dimensions$split$map","map","num","parseInt","width","height","extension","metadata","dimensions","aspectRatio","defaultOptions","quality","smartCrop","format","fill","toFormat","useBase64","defaultFluidOptions","_extends","maxWidth","maxHeight","defaultFixedOptions","isWebP","isConverted","includes","isOriginal","buildImageUrl","rotation","filters","concat","filter","element","Boolean","length","reduce","acc","currentFilter","i","applyFilters","console","log","buildLowFiUrl","_ref","toFixed","args","imageProps","options","desiredAspectRatio","forceConvert","srcSets","sizeMultipliersFixed","scale","Math","round","currentWidth","resolution","currentHeight","size","webpUrl","buildUrl","baseUrl","webp","push","base","outputHeight","imgSize","src","srcWebp","srcSet","join","srcSetWebp","sizes","sizeMultipliersFluid"],"mappings":"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"}